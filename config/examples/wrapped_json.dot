# JSON Configuration Example
# ------------------------------------------------------------------------------
# A simple example that parses incoming data as JSON. This example also
# demonstrated wrapped JSON, showing that you can chain parsers.

digraph {
  data_dir = "/var/lib/vector"

  subgraph sources {
    # Ingest data
    # Example: {"message": "{\"parent\": \"{\\\"child\\\": \\\"value2\\\"}\"}"}
    # Docs: https://vector.dev/docs/reference/sources/file
    logs [
      type = "file"
      include = "/var/log/*.log"
      ignore_older = 86400 # 1 day
    ]
  }

  subgraph transforms {
    # Parse the data as JSON
    # Docs: https://vector.dev/docs/reference/transforms/json_parser
    parse_root_json [
      type = "json_parser"
      field = "message" # default
    ]

    parse_parent_json [
      type = "json_parser"
      field = "parent"
    ]

    parse_child_json [
      type = "json_parser"
      field = "child"
    ]
  }

  subgraph sinks {
    # Print the data to STDOUT for inspection
    # Docs: https://vector.dev/docs/reference/sinks/console
    out [
      inputs = "parse_child_json"
      type = "console"
      encoding = "json"
    ]
  }

  # Set up the data flow
  logs -> parse_root_json -> parse_parent_json -> parse_child_json -> out
}
