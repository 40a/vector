---
id: kafka_to_prometheus
title: Writing Kafka Events to Prometheus
description: Learn how to send Kafka events to Prometheus with optional enrichments.
keywords: ["kafka","prometheus"]
---

In this guide we'll be consuming `kafka` logs and
writing them to a `prometheus` sink.

<!--truncate-->

<!--
      THIS FILE IS AUTOGENERATED!

      To make changes please edit the template located at: scripts/generate/templates/guides/guide.md.erb
-->

## Setup

If you haven't already, install Vector. Here's a script for the lazy:

```bash
curl --proto '=https' --tlsv1.2 -sSf https://sh.vector.dev | sh
```

Or [choose your preferred installation method][docs.installation].

## Configure a Source

Next, create a config file in a local directory (called `config.toml`) and add a
`kafka` source by pasting in this snippet:

```toml
[sources.my-source-id]
  # REQUIRED
  type = "kafka" # must be: "kafka"
  bootstrap_servers = "10.14.22.123:9092,10.14.23.332:9092" # example
  group_id = "consumer-group-name" # example
  topics = ["^(prefix1|prefix2)-.+", "topic-1", "topic-2"] # example

  # OPTIONAL
  key_field = "user_id" # example, no default
```

## (Optional) Parse Events

If our logs consumed from Kafka are structured then we should
parse them. We can do that with a range of [transforms][docs.transforms], in
this example we will use the `json_parser` transform:

```toml
[transforms.parser]
  # REQUIRED
  type = "json_parser" # must be: "json_parser"
  inputs = ["my-source-id"] # example
  drop_invalid = true # example

  # OPTIONAL
  drop_field = true # default
  field = "message" # default
```

Note that for the `inputs` field we specify our `kafka` source by
its name `my-source-id`.

This step is optional, if you choose to skip it then remember to set the
`inputs` of the next component to the previous component in the topology
(`my-source-id`).

## Transform Events

We will need to convert the log events consumed from our
`kafka` source into metrics. We can do that with a
`log_to_metric` transform:

```toml
[transforms.converter]
  # REQUIRED - General
  type = "log_to_metric" # must be: "log_to_metric"
  inputs = ["parser"] # example

  # REQUIRED - Metrics
  [[transforms.converter.metrics]]
    # REQUIRED
    type = "counter" # example, enum
    field = "duration" # example
    name = "duration_total" # example

    # OPTIONAL
    increment_by_value = false # default, relevant when type = "counter"
    [transforms.converter.metrics.tags]
      host = "${HOSTNAME}" # example
      region = "us-east-1" # example
      status = "{{status}}" # example
```

## (Optional) Enrich Events

We can also choose to enrich our events with [transforms][docs.transforms]. In
this example we're going to add a `add_tags` transform:

```toml
[transforms.enricher]
  # REQUIRED - General
  type = "add_tags" # must be: "add_tags"
  inputs = ["converter"] # example

  # REQUIRED - Tags
  [transforms.enricher.tags]
    static_tag = "my value" # example
    env_tag = "${ENV_VAR}" # example
```

Note that for the `inputs` field we specify `converter`.

This step is optional, if you choose to skip it then remember to set the
`inputs` of the next component to the previous component in the topology
(`converter`).

## Configure a Sink

Now we configure our sink, making sure to set the input to `enricher`:

```toml
[sinks.my-sink-id]
  # REQUIRED
  type = "prometheus" # must be: "prometheus"
  inputs = ["enricher"] # example
  address = "0.0.0.0:9598" # example
  namespace = "service" # example

  # OPTIONAL
  buckets = [0.005, 0.01, 0.025, 0.05, 0.1, 0.25, 0.5, 1.0, 2.5, 5.0, 10.0] # default, seconds
  flush_period_secs = 60 # default, seconds
```

## Run It

That's it, we're ready to execute our pipeline. You can run it locally with:

```sh
vector -c ./config.toml
```

Vector is very flexible and can be deployed in a way that suits your target
environment. For guidance check out our [deployment documentation][docs.deployment].


[docs.deployment]: /docs/setup/deployment/
[docs.installation]: /docs/setup/installation/
[docs.transforms]: /docs/reference/transforms/
